# ヤリクリ - 機能設計書

**アプリ名:**
- 日本語: **ヤリクリ 〜毎日使えるお金が見える〜**
- 英語: **yarikuri 〜Smart Daily Budget Manager〜**

**Version:** 1.0.0
**作成日:** 2025年11月12日
**ステータス:** プロトタイプ完成・Flutter実装準備中

---

## プロジェクト概要

**ヤリクリ**は、お小遣い制や固定費で毎月やりくりをする人のための支出管理アプリです。
「今日使えるお金」を明確に可視化し、日々の支出を記録しながら、計画的な貯蓄目標の達成をサポートします。

### 技術スタック

| 項目 | 本番実装（予定） |
|------|------------------|
| フレームワーク | **Flutter** |
| データ永続化 | Hive / SharedPreferences / SQLite |
| UI デザイン | Flutter Widgets + **liquid_glass_renderer** |
| 状態管理 | Provider / Riverpod |
| テーマ管理 | ThemeData + ChangeNotifier |

---

## 機能カテゴリ一覧

本アプリケーションは**13の機能カテゴリ**、**80以上の詳細機能**で構成されています。

### 1. 支出管理機能

**概要:**
支出の作成、読み取り、更新、削除（CRUD）を行い、日別・月別での表示と集計を提供します。

**主要機能:**
- 支出のCRUD操作（Create, Read, Update, Delete）
- 最近の支出リスト表示（デフォルト5件、もっと見る機能）
- 日別グループ表示（日付ヘッダー、時刻、カテゴリアイコン）
- カテゴリフィルタリング（6種類）
- 月間・日別の支出集計

**プロトタイプ実装箇所:**
- メインロジック: `app.js` (MoneyPouchApp)
- UI実装: `home.html` (追加・編集モーダル)、`history.html` (履歴リスト)

**Flutter実装時の考慮点:**
- `ListView.builder` で効率的なリスト表示
- 支出モデルクラス（Expense）の定義
- Hive/SQLiteでのデータ永続化

---

### 2. 予算管理機能

**概要:**
月間予算の設定と、「今日の予算」の動的・固定計算により、日々の使える金額を可視化します。

**主要機能:**
- 月間予算設定（金額、適用範囲）
- 今日の予算計算（動的 or 固定）
- 予算残高表示
- 月別予算管理

**プロトタイプ実装箇所:**
- メインロジック: `app.js` (calculateBalance, saveBudget)
- UI実装: `home.html` (予算設定モーダル、残高カード)

**Flutter実装時の考慮点:**
- 日次の予算リセット処理
- 予算計算ロジックの最適化
- 予算モデルクラス（Budget）の定義

---

### 3. 貯蓄目標管理機能

**概要:**
貯蓄目標を設定し、手動入金や自動積立により目標達成を管理します。達成時には自動判定されます。

**主要機能:**
- 目標のCRUD操作
- 手動入金・減額（総貯蓄額プールとの連携）
- 自動達成判定（現在額 ≥ 目標額）
- 目標カード表示（進捗率、プログレスバー）
- フィルタリング（すべて、未達成、達成済み）

**プロトタイプ実装箇所:**
- メインロジック: `app.js` (Goal関連メソッド)
- UI実装: `goals.html` (目標カード、管理モーダル)

**Flutter実装時の考慮点:**
- 目標モデルクラス（Goal）の定義
- `LinearProgressIndicator` でプログレスバー
- 達成アニメーション（Confetti効果など）

---

### 4. 総貯蓄額プール管理機能

**概要:**
余剰金を一元管理し、貯蓄目標への入金や引き出しを履歴付きで管理します。

**主要機能:**
- プール残高管理
- 入金・引き出し操作
- 履歴記録（メモ付き）
- 目標との資金移動

**プロトタイプ実装箇所:**
- メインロジック: `app.js` (SavingsPool関連メソッド)
- UI実装: `goals.html` (サマリーカード、入金/減額セクション)

**Flutter実装時の考慮点:**
- プールモデルクラス（SavingsPool）の定義
- トランザクション履歴の管理

---

### 5. カテゴリ管理機能

**概要:**
6種類の支出カテゴリを定義し、アイコンとカラーで視覚的に識別します。

**主要機能:**
- 6種類のカテゴリ定義（食費、娯楽、交通費、買い物、医療、その他）
- カテゴリアイコン表示（Material Icons）
- カテゴリカラー表示（全テーマ共通）

**プロトタイプ実装箇所:**
- 定義: `js/constants.js` (CATEGORIES)
- スタイル: `css/variables.css` (カテゴリカラー)

**Flutter実装時の考慮点:**
- Enumでカテゴリ定義
- `Icon` ウィジェットでMaterial Icons表示
- カテゴリ拡張時の設計（将来的なカスタムカテゴリ対応）

---

### 6. テーマ・外観管理機能

**概要:**
3種類のテーマ（デフォルト、ミッドナイト、ハッカー）を提供し、アプリ全体の配色を変更できます。

**主要機能:**
- 3種類のテーマ管理
- テーマ選択モーダル
- テーマの永続化
- FOUC対策（即座のテーマ適用）

**プロトタイプ実装箇所:**
- メインロジック: `js/theme.js`, `js/theme-init.js`
- スタイル定義: `css/variables.css`

**Flutter実装時の考慮点:**
- `ThemeData` でテーマ定義
- `ChangeNotifier` + `Provider` で状態管理
- ダークモード対応の検討

---

### 7. データ永続化機能

**概要:**
すべてのアプリデータをローカルに保存し、キャッシュにより高速なデータアクセスを実現します。

**主要機能:**
- データ管理（支出、予算、目標、プール、テーマ）
- メモリキャッシュシステム
- データのエラーハンドリング

**プロトタイプ実装箇所:**
- メインロジック: `app.js` (LocalStorage操作、キャッシュ管理)

**Flutter実装時の考慮点:**
- **Hive** でのローカルDB構築
- TypeAdapterでモデルのシリアライズ
- SharedPreferencesでの設定保存

---

### 8. 日付・時刻管理機能

**概要:**
日付の取得、計算、フォーマット変換を行い、アプリ全体で統一的な日付処理を提供します。

**主要機能:**
- 日付取得（現在の年月、今日の日付）
- 日付計算（月の日数、残り日数）
- 日付フォーマット（YYYY-MM-DD、M月D日、曜日）
- 時刻表示（HH:MM）

**プロトタイプ実装箇所:**
- メインロジック: `app.js` (日付関連ユーティリティメソッド)

**Flutter実装時の考慮点:**
- `DateTime` クラスの活用
- `intl` パッケージでのフォーマット
- タイムゾーン処理

---

### 9. 金額処理機能

**概要:**
金額のフォーマット表示と計算処理を提供します。

**主要機能:**
- 金額フォーマット（カンマ区切り、通貨記号）
- 金額計算（整数変換、合計計算）

**プロトタイプ実装箇所:**
- メインロジック: `app.js` (formatAmount, validateAmount)

**Flutter実装時の考慮点:**
- `NumberFormat` でのフォーマット
- `int` 型での金額管理（浮動小数点エラー回避）

---

### 10. バリデーション機能

**概要:**
ユーザー入力のバリデーションを行い、不正なデータの登録を防ぎます。

**主要機能:**
- 金額バリデーション（0円〜1000万円）
- カテゴリバリデーション（存在チェック）
- 日付バリデーション（有効性チェック）

**プロトタイプ実装箇所:**
- メインロジック: `app.js` (validate系メソッド)
- UI実装: `home.html`, `goals.html` (フォームバリデーション)

**Flutter実装時の考慮点:**
- `Form` + `TextFormField` でのバリデーション
- `validator` プロパティの活用

---

### 11. エラーハンドリング機能

**概要:**
エラーログの記録とユーザーへの通知を統一的に管理します。

**主要機能:**
- エラーログ記録
- エラーメッセージ表示
- 成功メッセージ表示
- 確認ダイアログ

**プロトタイプ実装箇所:**
- メインロジック: `js/error-handler.js`

**Flutter実装時の考慮点:**
- `SnackBar` でのトースト通知
- `AlertDialog` での確認ダイアログ
- グローバルエラーハンドラーの実装

---

### 12. UI/UX機能

**概要:**
Glassmorphismデザイン、アニメーション、アクセシビリティにより優れたUXを提供します。

**主要機能:**
- Glassmorphismデザイン（ぼかし、半透明、光沢）
- モーダル管理（アニメーション、Escキー対応）
- アクセシビリティ（キーボード操作、ARIA属性）
- レスポンシブデザイン
- アニメーション（トランジション、背景装飾）
- ボトムナビゲーション
- ドロワー（設定）

**プロトタイプ実装箇所:**
- スタイル: `css/liquid-glass.css`, `css/common.css`
- ロジック: 各HTMLファイル内のscriptセクション

**Flutter実装時の考慮点:**
- `liquid_glass_renderer` パッケージでGlassmorphism
- `Hero` アニメーション
- `BottomNavigationBar` ウィジェット
- `Drawer` ウィジェット
- アクセシビリティ（`Semantics`）

---

### 13. ユーティリティ機能

**概要:**
ID生成、イベント処理などの共通ユーティリティを提供します。

**主要機能:**
- ユニークID生成
- イベントデリゲーション

**プロトタイプ実装箇所:**
- メインロジック: `app.js` (generateId), `js/ui-common.js`

**Flutter実装時の考慮点:**
- `Uuid` パッケージでのID生成
- Flutterの宣言的UIにより、イベントデリゲーションは不要

---

## ドキュメント構成（予定）

各機能カテゴリごとに詳細設計書を作成します。

```
doc/
├── INDEX.md                    # この目次ファイル
├── 01_支出管理機能.md
├── 02_予算管理機能.md
├── 03_貯蓄目標管理機能.md
├── 04_総貯蓄額プール管理機能.md
├── 05_カテゴリ管理機能.md
├── 06_テーマ外観管理機能.md
├── 07_データ永続化機能.md
├── 08_日付時刻管理機能.md
├── 09_金額処理機能.md
├── 10_バリデーション機能.md
├── 11_エラーハンドリング機能.md
├── 12_UI_UX機能.md
├── 13_ユーティリティ機能.md
└── PRD.md                      # 既存のプロダクト要求仕様書
```

各機能設計書には以下を含めます：
- 機能概要
- ユースケース
- データモデル（Flutterクラス定義）
- UI設計（画面構成、ウィジェット構成）
- 処理フロー
- プロトタイプ実装箇所（参照情報）
- テストケース

---

## 次のステップ

1. ✅ プロトタイプ完成
2. 📝 機能設計書の作成（このドキュメント）
3. 🎨 Flutter UI設計・ウィジェットツリー設計
4. 🗄️ データモデル・状態管理設計
5. 💻 Flutter実装
6. 🧪 テスト実装
7. 🚀 リリース

---

**ヤリクリ Development Team**
